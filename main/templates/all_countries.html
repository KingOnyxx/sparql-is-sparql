{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Countries</h2>

    <!-- Filter and Sort Form -->
    <form method="get" class="form-inline mb-4">
        <!-- Sort By -->
        <label for="sortBy" class="mr-2">Sort by:</label>
        <select id="sortBy" name="sort" class="form-control mr-2" onchange="goToPage1(this.form)">
            <option value="default" {% if sort_by == "default" %}selected{% endif %}>Default (Unsorted)</option>
            <option value="label_asc" {% if sort_by == "label_asc" %}selected{% endif %}>Country Name (A-Z)</option>
            <option value="label_desc" {% if sort_by == "label_desc" %}selected{% endif %}>Country Name (Z-A)</option>
        </select>

        <!-- Items Per Page -->
        <label for="itemsPerPage" class="ml-4 mr-2">Show:</label>
        <select id="itemsPerPage" name="items_per_page" class="form-control mr-2" onchange="goToPage1(this.form)">
            <option value="10" {% if items_per_page == 10 %}selected{% endif %}>10</option>
            <option value="25" {% if items_per_page == 25 %}selected{% endif %}>25</option>
            <option value="50" {% if items_per_page == 50 %}selected{% endif %}>50</option>
        </select>
        countries per page

        <!-- Retain Current Page -->
        <input type="hidden" name="country_page" value="1">
    </form>

    <!-- Results Info -->
    <p class="text-muted">
        Showing {{ country_page.start_index }} to {{ country_page.end_index }} of {{ country_page.paginator.count }} countries.
    </p>

    <!-- Country Data Table -->
    <table class="table table-striped table-hover">
        <thead class="thead-light">
            <tr>
                <th>Country Name</th>
            </tr>
        </thead>
        <tbody>
            {% for country in country_page %}
                <tr>
                    <td>
                        <a href="{% url 'country_details' iso_country=country.code %}" class="text-primary">
                            {{ country.label }}
                        </a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination d-flex justify-content-between align-items-center">
        <div>
            {% if country_page.has_previous %}
                <a href="?country_page={{ country_page.previous_page_number }}&items_per_page={{ items_per_page }}&sort={{ sort_by }}" class="btn btn-outline-primary">
                    &laquo; Previous
                </a>
            {% endif %}
        </div>
        <span>Page {{ country_page.number }} of {{ country_page.paginator.num_pages }}</span>
        <div>
            {% if country_page.has_next %}
                <a href="?country_page={{ country_page.next_page_number }}&items_per_page={{ items_per_page }}&sort={{ sort_by }}" class="btn btn-outline-primary">
                    Next &raquo;
                </a>
            {% endif %}
        </div>
    </div>
</div>

<!-- JavaScript for Redirecting to Page 1 -->
<script>
    function goToPage1(form) {
        // Explicitly set the page parameter to 1 before submitting
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'country_page';
        input.value = '1';
        form.appendChild(input);
        form.submit();
    }
</script>
{% endblock %}
